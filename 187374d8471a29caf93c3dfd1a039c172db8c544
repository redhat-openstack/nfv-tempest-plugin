{
  "comments": [
    {
      "key": {
        "uuid": "191e4b43_847d1f3e",
        "filename": "nfv_tempest_plugin/tests/scenario/manager_utils.py",
        "patchSetId": 2
      },
      "lineNbr": 1030,
      "author": {
        "id": 1010167
      },
      "writtenOn": "2020-11-02T04:18:50Z",
      "side": 1,
      "message": "I was looking for the code reference upstream to see how/where these hiera is set, but I could not find the reference for these hieradata. Was this working on both 13 and 16.1? OR i am missing to find it. Can you provide on which file this key is stored under \"/etc/puppet/hieradata\"?",
      "revId": "187374d8471a29caf93c3dfd1a039c172db8c544",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e4544a4d_e43b1841",
        "filename": "nfv_tempest_plugin/tests/scenario/manager_utils.py",
        "patchSetId": 2
      },
      "lineNbr": 1030,
      "author": {
        "id": 1016438
      },
      "writtenOn": "2020-11-02T11:49:07Z",
      "side": 1,
      "message": "Hey,\n\nSure, I\u0027ve checked this both on OSP13 and OSP16, the file is \u0027/etc/puppet/hieradata/all_nodes.json\u0027",
      "parentUuid": "191e4b43_847d1f3e",
      "revId": "187374d8471a29caf93c3dfd1a039c172db8c544",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c896c1d_391aeb87",
        "filename": "nfv_tempest_plugin/tests/scenario/manager_utils.py",
        "patchSetId": 2
      },
      "lineNbr": 1030,
      "author": {
        "id": 1010167
      },
      "writtenOn": "2020-11-02T12:34:07Z",
      "side": 1,
      "message": "I am still looking for how it is being populated in osp13 and osp16 (deploying an environment, will confirm it). IIUC, it looks like this might be changed in OSP17, which does not have a refrence in the master. The ideal way that I would recommend is to get the list of enabled services (from the same hieradata) and then check if ovn or ovs-agent service is added. This depends on the list of services from the THT repo, which is also fixed and has not changed and not going to change in OSP17 too, i dont know about OSP18 :-). I can provide the exact heira key in sometime once the deployment is succesful.\n\nOVNController will be present on all compute nodes. \"ovn_controller\" is the service name. If it is not present in the enabled service it is safe to assume that it is ml2-ovs.\nhttps://github.com/openstack/tripleo-heat-templates/blob/master/deployment/ovn/ovn-controller-container-puppet.yaml#L133",
      "parentUuid": "e4544a4d_e43b1841",
      "revId": "187374d8471a29caf93c3dfd1a039c172db8c544",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6380eafa_a4d78922",
        "filename": "nfv_tempest_plugin/tests/scenario/manager_utils.py",
        "patchSetId": 2
      },
      "lineNbr": 1030,
      "author": {
        "id": 1016438
      },
      "writtenOn": "2020-11-03T10:01:54Z",
      "side": 1,
      "message": "This is a great point Saravanan.\nWill take your approach and view the enabled services instead of relying on a specific key.",
      "parentUuid": "6c896c1d_391aeb87",
      "revId": "187374d8471a29caf93c3dfd1a039c172db8c544",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05956047_6761f94d",
        "filename": "nfv_tempest_plugin/tests/scenario/manager_utils.py",
        "patchSetId": 2
      },
      "lineNbr": 1030,
      "author": {
        "id": 1010167
      },
      "writtenOn": "2020-11-03T10:57:45Z",
      "side": 1,
      "message": "The existing approach looks fine to. Just got hands on a cluster to understand all_nodes.json file. It creates all the service information across the cluster to all nodes. The name \"neutron_ovs_agent_enabled\" comes from \"\u003cservice_name\u003e_enabled\" which is applied for all the service names. So the existing approach will work fine even in master too. I am fine with it. But if you want to improve instead of checking 2 individual vars, checkng the services enalbed,  you can use \n\nhiera -c /etc/puppet/hiera.yaml enabled_services \u003e\u003e This will give the list of service enabled across all the roles in the whole cluster\n\nhiera -c /etc/puppet/hiera.yaml service_names \u003e\u003e This will give the list of services enabled in that particular role. \n\nSo , checking for the presense of \"neutron_ovs_agent_enabled: true\" is same as checking for the presense of \"neutron_ovs_agent\" in \"hiera -c /etc/puppet/hiera.yaml enabled_services\". I am fine with either ways, I am OK to merge it in the current state too, I will leave it to you to decide.",
      "parentUuid": "6380eafa_a4d78922",
      "revId": "187374d8471a29caf93c3dfd1a039c172db8c544",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}