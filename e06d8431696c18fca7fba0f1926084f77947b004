{
  "comments": [
    {
      "key": {
        "uuid": "bb830ec2_c71dc5d8",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008484
      },
      "writtenOn": "2019-01-01T06:31:47Z",
      "side": 1,
      "message": "This code is not needed.\nCurrently we have configuration file in tempest.conf.\n\nSo it could be configured there \n\ntransfer_files \u003d \u0027[{\"client_source\": \"/home/stack/tempest/nfv-tempest-plugin/nfv_tempest_plugin/tests/scenario/tests_scripts/custo\nm_net_config.py\", \"guest_destination\": \"/usr/local/bin/custom_net_config.py\"},{\"client_source\":\"/home/stack/tempest/nfv-tempest-plugin/nfv_tempest_plugin/tests/scenario/tests_scripts/multicast_traffic.py\":\"/tmp/multicast_traffic.py\"}]\n\u0027\n\nor enter as default param to ./nfv_tempest_plugin/config.py",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "530dd2b2_12b24439",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008672
      },
      "writtenOn": "2019-01-01T06:46:19Z",
      "side": 1,
      "message": "\u003e This code is not needed.\n\u003e Currently we have configuration file in tempest.conf.\n\u003e \n\u003e So it could be configured there \n\u003e \n\u003e transfer_files \u003d \u0027[{\"client_source\": \"/home/stack/tempest/nfv-tempest-plugin/nfv_tempest_plugin/tests/scenario/tests_scripts/custo\n\u003e m_net_config.py\", \"guest_destination\": \"/usr/local/bin/custom_net_config.py\"},{\"client_source\":\"/home/stack/tempest/nfv-tempest-plugin/nfv_tempest_plugin/tests/scenario/tests_scripts/multicast_traffic.py\":\"/tmp/multicast_traffic.py\"}]\n\u003e \u0027\n\u003e \n\u003e or enter as default param to ./nfv_tempest_plugin/config.py\n\n\nThe transfer_files default configuration within the config.py contains files that should be copied to any instance on boot.\n\nThe multicast_traffic.py script is used only for the multicast test and I don\u0027t see any reason to copy it to every instance on boot, so no reason to put it within the transfer_files default.\n\nFor that reason, I created the \"_add_copy_files_to_personality\" method that should be used for copying the files dedicated for the specific test using the personality and integrated it into the \"create_server_with_resources\" method.",
      "parentUuid": "bb830ec2_c71dc5d8",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f65e460f_22c4f0af",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008484
      },
      "writtenOn": "2019-01-06T13:18:14Z",
      "side": 1,
      "message": "It is extra copy, through scp, IMHO copy every thing in one shot even if test does not use it.\nLess ssh or copy is recommended,\n\n@Vadim? what\u0027s your take here?",
      "parentUuid": "530dd2b2_12b24439",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9abb2147_33237f2c",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008672
      },
      "writtenOn": "2019-01-06T13:23:33Z",
      "side": 1,
      "message": "\u003e It is extra copy, through scp, IMHO copy every thing in one shot even if test does not use it.\n\u003e Less ssh or copy is recommended,\n\u003e \n\u003e @Vadim? what\u0027s your take here?\n\n@Yariv,\n\nIt looks like you missed it.\nIt is not extra copy and for sure not a use of scp.\nI\u0027m appending the script using the personality to the kwargs during the server creation.\n\nAs a result, the script passed to the instance using the same mechanism as the custom_net_config.py with the same iteration during the server creation.\nThe only difference is that I\u0027m copying it only when needed and not during every test.",
      "parentUuid": "f65e460f_22c4f0af",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "20982dc8_61ea1272",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1014336
      },
      "writtenOn": "2019-01-07T09:16:03Z",
      "side": 1,
      "message": "Correct me if I\u0027m wrong but:\n\nYariv wants the ability to dynamically append additional scripts that will be transferred to tests without having to modify the tests each time.\n\nI think it\u0027s a good approach to have in the future, not sure if it should be part of this patch.",
      "parentUuid": "9abb2147_33237f2c",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "113cf099_86d3f920",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008672
      },
      "writtenOn": "2019-01-07T10:33:19Z",
      "side": 1,
      "message": "@Vadim,\n\nThat\u0027s exactly what I\u0027m trying to achieve.\nI would like to append the script to the instance when needed. For that, I created the _add_copy_files_to_personality method in baremetal_manager.\nThe method integrated within the create_server_with_resources method and all that needs to be done from the test side is to specify the src and dest of the script I would like to use.\nIf specified, the method is triggered automatically.\n\nI don\u0027t think that keep this script in config.py alongside with the custon_net_script.py is a good idea because it will be copied to each instance in every test, which is overkill from my perspective.\n\nIn addition, by default, the amount of the files that could be copied to the instance using personality is limited to 5. Of course, the limit could be modified by the admin, but as I said, I don\u0027t see a reason to copy a script that is not related to the test, to the instance of that test.\n\nhttps://developer.openstack.org/api-guide/compute/limits.html",
      "parentUuid": "20982dc8_61ea1272",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ca227d1c_117caa28",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1014336
      },
      "writtenOn": "2019-01-07T10:37:14Z",
      "side": 1,
      "message": "@Maxim\n\nWe meant that as a user you could provide an additional files from an external source (either tempest.conf or ci_network_config.yaml) to be transferred regardless of test.\n\nAlso, personality is deprecated from 2.57 and user_data is used instead. We could be proactive and migrate to it.",
      "parentUuid": "113cf099_86d3f920",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8199f659_92fc0fb8",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008672
      },
      "writtenOn": "2019-01-07T14:24:33Z",
      "side": 1,
      "message": "The config.py file has a default with contains the custon_net_config.py file and the file copied to every booted instance.\nIt makes sense since the file is required by any instance for the network configuration.\n\nThe multicast_traffic.py test used only in multicast test, and I see no issue for the file to be specified within the test to be appended to the personality during instance creation.\nAfter all the test is a list of actions that should be performed and one of them is the script copy.\nThe usage of the multicast_traffic.py script in the multicast test is required as it is a multicast test, so specifying the script in the external_config will add unnecessary confusion to the external_config file.\n\nWe can\u0027t migrate to microversion 2.57 as osp 10 does not support it.\nAnd separate the microversion support per version will add a lot of maintenance to the plugin.",
      "parentUuid": "ca227d1c_117caa28",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9b13340a_7433d51f",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008484
      },
      "writtenOn": "2019-01-14T09:19:09Z",
      "side": 1,
      "message": "Sure,\nWe should copy all of our test scripts into vm,\nAt the end it all has to run in data plane, we should trigger them by cloud-init\nIt is obvious that all scripts will be copied to VM with user-data file",
      "parentUuid": "8199f659_92fc0fb8",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9e5644d2_949a9145",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1014336
      },
      "writtenOn": "2019-01-14T12:28:01Z",
      "side": 1,
      "message": "Currently, we have an option to transfer a script to ALL booted VMs(like we do with custom_net_config.py). Maxim introduced a way to specify which additional files to transfer to an instance during test execution.\n\nSo if I\u0027m understanding correctly (correct me if I\u0027m wrong):\n* Maxim doesn\u0027t want to bloat other instances with unnecessary scripts (for example MTU on numa test)\n* Yariv wants all instances to have all scripts and they\u0027ll be triggered via cloud-init or during test\n\nWhat I\u0027m thinking: Perhaps we should expose an additional attribute to tests which will leverage Maxim\u0027s addition:\n\ntests-setup:\n - name: numa0\n   flavor: m1.medium.huge_pages_cpu_pinning_numa_node-0\n   router: true\n   scripts:\n     - {\u0027src\u0027: /path/to/script, \u0027dest\u0027: /path/to/dest }\n\nThat way numa0 test will always have the default scripts mentioned in tempest.conf and we\u0027ll be able to transfer to specific test additional files.",
      "parentUuid": "9b13340a_7433d51f",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "198949d7_923becea",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008672
      },
      "writtenOn": "2019-01-14T12:39:17Z",
      "side": 1,
      "message": "I do think that bloating each test instances with all the scripts is not a good idea.\nEspecially, when there is a default limit to 5 files to copy - https://developer.openstack.org/api-guide/compute/limits.html\n\nBut I do not think that we need to specify the files we would like to copy within the external config file. The multicast traffic script is not optional to the multicast test, so add it to the external config will add an overload to the config file.\n\nIf the script is required for the test, and it is, why not to specify it within the test as it is done in the current patch?",
      "parentUuid": "9e5644d2_949a9145",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d775e7cc_d1584381",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008484
      },
      "writtenOn": "2019-01-14T17:39:24Z",
      "side": 1,
      "message": "We tend to get rid of ci_network_config, and you insist to put it back :)\nWe never discussed it, IMHO, it is about time, we have to move into profile configurations.\nAny way, FIP images will have their defaults in tempest.conf, virt-customize will help us at preparing images as a start, \n\nso if you get my point, better to move back to configuration file, and plan the future :)",
      "parentUuid": "198949d7_923becea",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa29c1ba_e041bb02",
        "filename": "nfv_tempest_plugin/tests/scenario/test_nfv_dpdk_usecases.py",
        "patchSetId": 6
      },
      "lineNbr": 134,
      "author": {
        "id": 1008672
      },
      "writtenOn": "2019-01-14T19:05:10Z",
      "side": 1,
      "message": "I agree that we need to get rid of the external_config file, but let\u0027s get stick with the subject.\n\nVadim, please, provide your opinion regarding the two options discussed in the thread.\n* Set the multicast_traffic.py script to the defaults and pass it to every created instance.\n* Add the script to the personality during the server creation only when needed.\n\nWhat do you think is preferred here from your point of view?",
      "parentUuid": "d775e7cc_d1584381",
      "range": {
        "startLine": 131,
        "startChar": 45,
        "endLine": 134,
        "endChar": 68
      },
      "revId": "e06d8431696c18fca7fba0f1926084f77947b004",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}